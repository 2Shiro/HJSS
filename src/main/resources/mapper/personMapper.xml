<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.green.mapper.PersonMapper">
	<!-- 이력서 아이디로 이력서 불러오기 -->
	<select id="getResume">
		SELECT RESUME_IDX, ID, PROFILE, TITLE, PORTFOLIO, PUBLISH, SELF_INTRO, TO_CHAR(created_at, 'YY-MM-DD') created_at FROM RESUME_TB WHERE RESUME_IDX = #{resume_id}
	</select>
	
	<select id="getPuser">
	 SELECT ID, PNAME, PHONE, ADDRESS, BIRTH FROM PERSON_INFO_TB WHERE ID = #{id}
	</select>
	
	<select id="getUser">
	 SELECT ID, PASSWORD, TYPE, USER_EMAIL, TO_CHAR(CREATED_DATE, 'YY-MM-DD') CREATED_DATE FROM USER_TB WHERE ID = #{id}
	</select>

	<select  id = "getPerson" resultType = "com.green.domain.PersonVo">
		
		SELECT	ID,
				PNAME,
				PHONE,
				ADDRESS,
				TO_CHAR( BIRTH, 'YY-MM-DD')	BIRTH
		FROM	PERSON_INFO_TB
		WHERE	ID = 'ps1'
	
	</select>
	
	<!-- 기업의 공고 리스트에 구직자 이름을 위한 id String으로 구직자 데이터 가져오기 -->
	<select id="getPname">
		SELECT	ID, PNAME, PHONE, ADDRESS, TO_CHAR( BIRTH, 'YY-MM-DD')	BIRTH FROM	PERSON_INFO_TB WHERE ID = #{id}
	</select>
	
	<!-- 구직자의 이력서 리스트 가져오기 -->
	<select id="getResumeList">
		SELECT RESUME_IDX, ID, PROFILE, TITLE, PORTFOLIO, PUBLISH, SELF_INTRO, TO_CHAR(created_at, 'YY-MM-DD') created_at FROM RESUME_TB WHERE ID = #{id}
	</select>
	
	<select id="login">
 	SELECT id,password,type
 	FROM   user_tb
 	WHERE  id=#{arg0} AND password=#{arg1} AND type=2
	</select>
	
	<!-- 구직자가 지원하기 -->
	<insert id="insertProposal">
		INSERT INTO PERSON_PROPOSAL_TB ( PRO_IDX, ID, POST_IDX, RESUME_IDX )
  	VALUES ( (SELECT NVL(MAX(PRO_IDX), 0) + 1 FROM PERSON_PROPOSAL_TB), #{arg0}, #{arg1}, #{arg2});
	</insert> 
	
	<insert id="insert">
	INSERT ALL	
	INTO person_info_tb ( id, pname, phone, address, birth )
	VALUES (#{id},#{pname},#{phone},#{address},#{birth})
	INTO user_tb (id,password,type,user_email,created_date)
	VALUES (#{id},#{password},2,#{user_email},#{created_date})
	SELECT * FROM DUAL
	</insert>
	
	<update id="updateResumePass">
		UPDATE PERSON_PROPOSAL_TB SET STATUS = #{arg1} WHERE RESUME_IDX = #{arg0}
	</update> 

</mapper>