<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.green.mapper.PersonMapper">

	<select id="getResume">
		SELECT RESUME_IDX, ID, PROFILE, TITLE, PORTFOLIO, PUBLISH, SELF_INTRO,
		TO_CHAR(created_at, 'YY-MM-DD') created_at FROM RESUME_TB WHERE
		RESUME_IDX = #{resume_idx}
	</select>


	<select id="getPerson" resultType="com.green.domain.PersonVo">

		SELECT ID,
		PNAME,
		PHONE,
		ADDRESS,
		TO_CHAR( BIRTH, 'YY-MM-DD') BIRTH
		FROM PERSON_INFO_TB
		WHERE ID = 'ps1'

	</select>

	<insert id="insert">
		INSERT ALL
		INTO person_info_tb ( id, pname, phone, address, birth )
		VALUES (#{id},#{pname},#{phone},#{address},#{birth})
		INTO user_tb (id,password,type,user_email,created_date)
		VALUES (#{id},#{password},2,#{user_email},#{created_date})
		SELECT * FROM DUAL
	</insert>

	<select id="login">
		SELECT id,password,type
		FROM user_tb
		WHERE id=#{arg0} AND password=#{arg1} AND type=2
	</select>

	<select id="getresumeList" parameterType="String"
		resultType="com.green.domain.PresumeVo">
		select * from RESUME_TB
		WHERE ID = #{id}
	</select>
	<select id="getInfo">
		select * from PERSON_INFO_TB WHERE ID = #{id}
	</select>

	<select id="loadskills" parameterType="String">
		select p.skill_idx, s.skill_name, p.id
		from person_skill_tb p, skill_tb s
		where s.skill_idx = p.skill_idx
		and p.id = #{id}
	</select>
	<insert id="insertResume" parameterType="com.green.domain.PresumeVo">
		INSERT INTO RESUME_TB
		(RESUME_IDX, ID, TITLE, PORTFOLIO, PUBLISH, profile , SELF_INTRO)
		VALUES
		((SELECT NVL(MAX(resume_idx),0) + 1 FROM RESUME_TB), #{id},
		#{title}, #{portfolio}, #{publish}, #{profile},
		#{self_intro})
	</insert>
	<insert id="insertskills" parameterType="com.green.domain.PersonskillVo">
		INSERT INTO PERSON_SKILL_TB (psno, ID, skill_idx)
		VALUES ((SELECT NVL(MAX(psno),0) + 1 FROM PERSON_SKILL_TB), #{id},
		#{skill_idx})
	</insert>
	<delete id="resumeDelete">
		DELETE FROM RESUME_TB WHERE RESUME_IDX = #{resume_idx}
	</delete>
	<delete id="deletepersonskills">
		DELETE FROM PERSON_SKILL_TB WHERE ID = #{id}
	</delete>
</mapper>